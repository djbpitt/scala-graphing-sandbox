<?xml version="1.0" encoding="UTF-8"?><stylesheet xmlns="http://www.w3.org/1999/XSL/Transform" xmlns:cx="http://interedition.eu/collatex/ns/1.0" xmlns:svrl="http://purl.oclc.org/dsdl/svrl" version="3.0" expand-text="false"><variable name="Q{http://dmaus.name/ns/2023/schxslt}phase" as="Q{http://www.w3.org/2001/XMLSchema}string" select="'#ALL'"/><mode use-accumulators=""/><mode name="group.d2e7" on-no-match="shallow-skip" streamable="false" use-accumulators=""/><template match="*" mode="group.d2e7" priority="-10"><apply-templates select="@*" mode="#current"/><apply-templates select="node()" mode="#current"/></template><template match="cx:witness/@siglum" mode="group.d2e7" priority="1"><param name="Q{http://dmaus.name/ns/2023/schxslt}pattern" as="Q{http://www.w3.org/2001/XMLSchema}string*" select="()"/><choose><when test="'d2e7' = $Q{http://dmaus.name/ns/2023/schxslt}pattern"><svrl:suppressed-rule context="cx:witness/@siglum"><if test="document-uri()"><attribute name="document" select="document-uri()"/></if></svrl:suppressed-rule><next-match><with-param name="Q{http://dmaus.name/ns/2023/schxslt}pattern" as="Q{http://www.w3.org/2001/XMLSchema}string*" select="$Q{http://dmaus.name/ns/2023/schxslt}pattern"/></next-match></when><otherwise><svrl:fired-rule context="cx:witness/@siglum"><if test="document-uri()"><attribute name="document" select="document-uri()"/></if></svrl:fired-rule><variable name="my-siglum" select="."/><variable name="preceding-same-sigla" select="../preceding-sibling::cx:witness[@siglum eq $my-siglum]"/><variable name="following-same-sigla-pos" select="../following-sibling::cx:witness[@siglum eq $my-siglum] ! (count(preceding-sibling::cx:witness) + 1)"/><if test="empty($preceding-same-sigla) and count($following-same-sigla-pos) eq 1"><variable name="successful-report" as="element(svrl:successful-report)"><svrl:successful-report test="empty($preceding-same-sigla) and count($following-same-sigla-pos) eq 1"><attribute name="location" select="path(.)"/><svrl:text> The
        current siglum is duplicated in the witness at offset <value-of select="$following-same-sigla-pos"/>. </svrl:text></svrl:successful-report></variable><sequence select="$successful-report"/></if><if test="empty($preceding-same-sigla) and count($following-same-sigla-pos) gt 1"><variable name="successful-report" as="element(svrl:successful-report)"><svrl:successful-report test="empty($preceding-same-sigla) and count($following-same-sigla-pos) gt 1"><attribute name="location" select="path(.)"/><svrl:text> The
        current siglum is duplicated in the witnesses at offsets <value-of select="string-join($following-same-sigla-pos, ', ')"/>. </svrl:text></svrl:successful-report></variable><sequence select="$successful-report"/></if><next-match><with-param name="Q{http://dmaus.name/ns/2023/schxslt}pattern" as="Q{http://www.w3.org/2001/XMLSchema}string*" select="('d2e7', $Q{http://dmaus.name/ns/2023/schxslt}pattern)"/></next-match></otherwise></choose></template><template match="cx:witness/@url" mode="group.d2e7" priority="0"><param name="Q{http://dmaus.name/ns/2023/schxslt}pattern" as="Q{http://www.w3.org/2001/XMLSchema}string*" select="()"/><choose><when test="'d2e7' = $Q{http://dmaus.name/ns/2023/schxslt}pattern"><svrl:suppressed-rule context="cx:witness/@url"><if test="document-uri()"><attribute name="document" select="document-uri()"/></if></svrl:suppressed-rule><next-match><with-param name="Q{http://dmaus.name/ns/2023/schxslt}pattern" as="Q{http://www.w3.org/2001/XMLSchema}string*" select="$Q{http://dmaus.name/ns/2023/schxslt}pattern"/></next-match></when><otherwise><svrl:fired-rule context="cx:witness/@url"><if test="document-uri()"><attribute name="document" select="document-uri()"/></if></svrl:fired-rule><variable name="my-base-uri" select="string((document-uri(/), base-uri(/))[. ne ''][1])"/><variable name="my-resolved-uri" select="resolve-uri(., $my-base-uri)"/><variable name="preceding-resolved-same-uris" select="           (../preceding-sibling::cx:witness/@url           ! resolve-uri(., $my-base-uri))[. eq $my-resolved-uri]"/><variable name="following-resolved-same-uris-pos" select="           ../following-sibling::cx:witness[           resolve-uri(@url, $my-base-uri) eq $my-resolved-uri           ] ! (count(preceding-sibling::cx:witness) + 1)"/><if test="empty($preceding-resolved-same-uris) and count($following-resolved-same-uris-pos) eq 1"><variable name="successful-report" as="element(svrl:successful-report)"><svrl:successful-report test="empty($preceding-resolved-same-uris) and count($following-resolved-same-uris-pos) eq 1"><attribute name="location" select="path(.)"/><svrl:text> The current @url (<value-of select="."/>) is duplicated in the witness at offset
          <value-of select="$following-resolved-same-uris-pos"/>. </svrl:text></svrl:successful-report></variable><sequence select="$successful-report"/></if><if test="empty($preceding-resolved-same-uris) and count($following-resolved-same-uris-pos) gt 1"><variable name="successful-report" as="element(svrl:successful-report)"><svrl:successful-report test="empty($preceding-resolved-same-uris) and count($following-resolved-same-uris-pos) gt 1"><attribute name="location" select="path(.)"/><svrl:text> The current @url (<value-of select="."/>) is duplicated in the witnesses at offsets
          <value-of select="string-join($following-resolved-same-uris-pos, ', ')"/>. </svrl:text></svrl:successful-report></variable><sequence select="$successful-report"/></if><if test="not(unparsed-text-available($my-resolved-uri))"><variable name="failed-assert" as="element(svrl:failed-assert)"><svrl:failed-assert test="unparsed-text-available($my-resolved-uri)"><attribute name="location" select="path(.)"/><svrl:text> The url <value-of select="."/> cannot be resolved. </svrl:text></svrl:failed-assert></variable><sequence select="$failed-assert"/></if><next-match><with-param name="Q{http://dmaus.name/ns/2023/schxslt}pattern" as="Q{http://www.w3.org/2001/XMLSchema}string*" select="('d2e7', $Q{http://dmaus.name/ns/2023/schxslt}pattern)"/></next-match></otherwise></choose></template><template match="root()" as="element(svrl:schematron-output)"><svrl:schematron-output phase="#ALL"><svrl:ns-prefix-in-attribute-values prefix="cx" uri="http://interedition.eu/collatex/ns/1.0"/><!--SchXslt2 Core v1.3.5--><try><svrl:active-pattern><attribute name="documents" select="document-uri(.)"/></svrl:active-pattern><apply-templates select="." mode="group.d2e7"/><catch><svrl:error code="{$Q{http://www.w3.org/2005/xqt-errors}code}"><if test="document-uri()"><attribute name="document" select="document-uri()"/></if><if test="$Q{http://www.w3.org/2005/xqt-errors}description"><value-of select="$Q{http://www.w3.org/2005/xqt-errors}description"/></if></svrl:error><variable name="message" as="Q{http://www.w3.org/2001/XMLSchema}string+" expand-text="yes">
                  Running the ISO Schematron validation failed with a dynamic error.
                  Error code: {$Q{http://www.w3.org/2005/xqt-errors}code} Reason: {$Q{http://www.w3.org/2005/xqt-errors}description}
                </variable><message terminate="yes" error-code="Q{{http://dmaus.name/ns/2023/schxslt}}ValidationError"><text/><value-of select="normalize-space(string-join($message))"/></message></catch></try></svrl:schematron-output></template></stylesheet>